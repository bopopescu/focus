<link rel="stylesheet" href="/static/ui-lightness/jquery-ui-1.8.6.custom.css">

<script>
    $(function() {

        {% for field in form %}
            var {{ field_id }}_{{ field.name }} = $("#id_{{ field.html_name }}");
        {% endfor %}

        $("#dialog-form{{ field_id }}").dialog({
            autoOpen: false,
            width: 550,
            modal: true,
            buttons: {
                "Ny kunde": function() {
                    var bValid = true;
                    if (bValid) {
                        $.post("{{ add_ajax_url }}",
                        {

                            {% for field in form %}
                                {{ field.name }}: {{ field_id }}_{{ field.name }}.val(),
                            {% endfor %}

                        },
                              function(data) {

                                  $("#id_{{ field_id }}").append("<option value='" + data["id"] + "'>" + data["name"] + "</option>");
                                  $('#id_{{ field_id }} option[value=' + data['id'] + ']').attr('selected', 'selected');
                              }

                                );

                        $(this).dialog("close");

                    }
                },
                Cancel: function() {
                    $(this).dialog("close");
                }
            },

            close:
            function() {

            }
        });

        $("#create_{{ field_id }}")
                .click(function() {
            $("#dialog-form{{ field_id }}").dialog("open");
        });

        $("#dialog-form{{ field_id }}").hide();

    });
</script>

<div id="dialog-form{{ field_id }}">
    <form id="thisForm{{ field_id }}">
        <fieldset>
            {% for field in form %}
                {{ field.label_tag }}<br>
                {{ field }}
                {% for error in field.errors %}
                    <span style="color:red">{{ error }}</span>
                {% endfor %}
                <br>
            {% endfor %}
        </fieldset>
    </form>
</div>

<span id="create_{{ field_id }}"><img width="15px" height="15px" style='vertical-align:middle;'
                                      src="{{ STATIC_URL }}img/add.png"></span>